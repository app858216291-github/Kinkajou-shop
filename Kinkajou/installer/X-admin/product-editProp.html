<!DOCTYPE html>
<html class="x-admin-sm">
	<head>
		<meta charset="UTF-8">
		<title>欢迎页面-X-admin2.2</title>
		<meta name="renderer" content="webkit">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8,target-densitydpi=low-dpi" />
		<link rel="stylesheet" href="./css/font.css">
		<link rel="stylesheet" href="./css/xadmin.css">
		<script type="text/javascript" src="./lib/layui/layui.js" charset="utf-8"></script>
		<script type="text/javascript" src="./js/xadmin.js"></script>
		<script type="text/javascript" src="./js/common.js"></script>
		<!-- 让IE8/9支持媒体查询，从而兼容栅格 -->
		<!--[if lt IE 9]>
            <script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
            <script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->
	</head>
	<style>
		.layui-upload-img{width: 92px; height: 92px; margin: 0 10px 10px 0;}
		.layui-upload{margin-left: 70px;}
		.layui-upload_detail{margin-left: 70px;}
	</style>
	<script>
		function getQueryVariable(variable)
	{
		   var query = window.location.search.substring(1);
		   var vars = query.split("&");
		   for (var i=0;i<vars.length;i++) {
				   var pair = vars[i].split("=");
				   if(pair[0] == variable){return pair[1];}
		   }
		   return(false);
	};
</script>
	<body>
		<div class="layui-fluid">
			<div class="layui-row">
				<form class="layui-form" action="" lay-filter="example">
					<input type="hidden" id="temp1" name="main_image" value="" />
					<input type="hidden" id="temp2" name="detail_image" value="" />

					<!-- 属性编辑 -->
					<div class="layui-form-item">
						<div class="layui-col-md4">
							<label class="layui-form-label">基本属性</label>
							<div class="layui-input-block">
								<select name="baseselect" id="baseselect" lay-filter="baseselect" xm-select="baseselect"
								 xm-select-type="1">
									<option value="0"></option>
									<option value="1">数量</option>
									<option value="2">颜色</option>
									<option value="3">形状</option>
									<option value="4">大小</option>
								</select>
							</div>
						</div>
					</div>
					<table class="layui-hide" id="shuxing" lay-filter="test"></table>
					<div class="layui-form-item">
						<div class="layui-col-md4">
							<label class="layui-form-label">附加属性</label>
							<div class="layui-input-block">
								<select name="fujiaselect" id="fujiaselect" lay-filter="fujiaselect" xm-select="fujiaselect"
								 xm-select-type="1">
									<option value="0"></option>
									<option value="1">数量</option>
									<option value="2">颜色</option>
									<option value="3">形状</option>
									<option value="4">是否含盆</option>
								</select>
							</div>
						</div>
					</div>
					<table class="layui-hide" id="fujiashuxing" lay-filter="test"></table>
					<div class="layui-form-item">
						<div class="layui-col-md4">
							<label class="layui-form-label">商品销售规格<span style="color:red">●</span></label>
							
						</div>
					</div>
					
					<table class="layui-hide" id="datatable" lay-filter="test"></table>
					<div class="layui-form-item">
						<label for="L_repass" class="layui-form-label"></label>
						<button class="layui-btn" lay-filter="add" lay-submit="" id="test9">修改<i id="upload"></i></button>
						<button style="display: none;" class="layui-btn" lay-filter="add" lay-submit="" id="hiddenBottono">修改2</button>
					</div>
				</form>
			</div>
		</div>

		<script>
			layui.use(['form', 'layer', 'table'],
				function() {
					var shuxing=[{
							"propertyname": "一苗","propertyid": "11","LAY_CHECKED":true
						}, {
							"propertyname": "2苗","propertyid": "12"
						},{
							"propertyname": "3苗","propertyid": "13"
						},{
							"propertyname": "4苗","propertyid": "14"
						},{
							"propertyname": "5苗","propertyid": "15"
						}]
					var fujia=[{
							"propertyname": "含盆","propertyid": "41","LAY_CHECKED":true
						}, {
							"propertyname": "不含盆","propertyid": "42"
						}]
					var data=[]
					//表单初始赋值

					$ = layui.jquery;
					$.ajaxSettings.async = false;
					var form = layui.form,
						layer = layui.layer,
					table = layui.table;
					tablefujia = layui.table;
					datatable = layui.table;
					datatable.on('checkbox(user)', function(obj){
					});
					<!--  table start-->
					table.render({
						elem: '#shuxing',
						title: '用户表',
						even: true //开启隔行背景
							,
						size: 'sm',
						data: shuxing,
						done: function(res) {
								data = res.data;
							}
							// ,toolbar: 'default' //开启工具栏，此处显示默认图标，可以自定义模板，详见文档
							,
						cols: [
							[ //表头
								{
									type: 'checkbox'
								}, {
									field: 'propertyname',
									title: '名称',
									width: 80,
									edit: 'text'
								}
							]
						]
					});
					

					<!--  table附加属性>
					tablefujia.render({
						elem: '#fujiashuxing',
						title: '用户表',
						even: true //开启隔行背景
							,
						size: 'sm',
						data: fujia,
						done: function(res) {
								data = res.data;
							}
							// ,toolbar: 'default' //开启工具栏，此处显示默认图标，可以自定义模板，详见文档
							,
						cols: [
							[ //表头
								{
									type: 'checkbox'
								}, {
									field: 'propertyname',
									title: '名称',
									width: 80,
									edit: 'text'
								}
							]
						]
					});



					
					<!--  table 销售属性>			
					table.render({
						id:"datatable",
						elem: '#datatable',
						title: '用户表',
						even: true, //开启隔行背景
						data:[],
						done: function(res) {
								data = res.data;
							}
							// ,toolbar: 'default' //开启工具栏，此处显示默认图标，可以自定义模板，详见文档
							,
						cols: [
							[ //表头
								{
									field: 'basename',
									title: '基本属性',
									width: 150,
									edit: 'text'
								},{
									field: 'funame',
									title: '附加属性',
									width: 150,
									edit: 'text'
								},{
									field: 'price',
									title: '价格',
									width: 80,
									edit: 'text'
								},{
									field: 'store',
									title: '库存',
									width: 80,
									edit: 'text'
								}
							]
						]
					});



					table.on('checkbox(test)', function(obj){
						
						dd=[]
						shuxing=layui.table.cache["shuxing"] 
						fujiashuxing=layui.table.cache["fujiashuxing"] 
						for(var sx=0;sx<shuxing.length;sx++){
							for(var fjsx=0;fjsx<fujiashuxing.length;fjsx++){
								if(shuxing[sx].LAY_CHECKED&&fujiashuxing[fjsx].LAY_CHECKED){
								dd.push({"baseid": shuxing[sx].propertyid,"basename": shuxing[sx].propertyname,"fuid": fujiashuxing[fjsx].propertyid,"funame": fujiashuxing[fjsx].propertyname})
								}
							}
						}
						// dd=[{
						// 		"title": "一苗3","id": "1"
						// 	}, {
						// 		"title": "2苗3","id": "2"
						// 	}]
						
						table.reload('datatable', {
						data: dd
						});
			
				
						c=layui.table.cache["datatable"] 
						
					});

					<!-- table end -->

					let product = {}
					debugger
					let skufirs="";
					let skusecond="";
					let skuthird="";
					$.get(prop().serviceUrl + "/product/skuview?productid=" + getQueryVariable("productid"), function(data, status) {
						debugger
						product = data
						product = JSON.parse(product);
						productprop=product.data;
						table.reload('datatable', {
						data: productprop.skuthird
						});
						
						// uploadInst.upload();
					});
					form.val('example', product.data)

					//自定义验证规则
					form.verify({
						title: function(value) {
							if (value.length < 5) {
								return '昵称至少得5个字符啊';
							}
							if (skufirst.basename=="无选择") {
								return 'basename不能为空';
							}
							if (skufirst.funame=="无选择") {
								return 'funame请选择';
							}
						},
					});

					//监听提交
					form.on('submit(add)',
						function(data) {
							shuxing=layui.table.cache["shuxing"] ;
							fujiashuxing=layui.table.cache["fujiashuxing"] ;
							skus=layui.table.cache["datatable"] ;
							// dd=data;
							debugger;
							let skufirst={};
							skufirst.baseid=data.field.baseselect
							if(skufirst.baseid==1){
								skufirst.basename="数量"
							}else if ( skufirst.baseid==2) {
								skufirst.basename="颜色"
							} else if ( skufirst.baseid==3) {
								skufirst.basename="形状"
							} else if ( skufirst.baseid==4) {
								skufirst.basename="是否含盆"
							} else{
								alert("请选择基本属性")
								return false
								// skufirst.basename="无选择"
								
							}
							
							skufirst.fuid=data.field.fujiaselect
							if(skufirst.fuid==1){
								skufirst.funame="数量"
							}else if ( skufirst.fuid==2) {
								skufirst.funame="颜色"
							} else if ( skufirst.fuid==3) {
								skufirst.funame="形状"
							} else if ( skufirst.fuid==4) {
								skufirst.funame="是否含盆"
							} else{
								alert("请选择附加属性")
								return false
								skufirst.funame="无选择"
							}
							
							let param={"productid":getQueryVariable("productid"),"shuxing":shuxing,"fujiashuxing":fujiashuxing,"skus":skus,"skufirst":skufirst}
							param=JSON.stringify(param)
							$.get(prop().serviceUrl+"/product/skuedit?param="+param,{},function(data,status){
								debugger
								product=data
								product= JSON.parse(product);
							});
							layer.alert("增加成功", {
									icon: 6
								},
								function() {
									// 获得frame索引
									var index = parent.layer.getFrameIndex(window.name);
									//关闭当前frame
									parent.layer.close(index);
								});
							return false;
						});

				});
		</script>

	</body>

</html>

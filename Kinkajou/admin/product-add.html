<!DOCTYPE html>
<html class="x-admin-sm">
    <head>
        <meta charset="UTF-8">
        <title>欢迎页面-X-admin2.2</title>
        <meta name="renderer" content="webkit">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8,target-densitydpi=low-dpi" />
        <link rel="stylesheet" href="./css/font.css">
        <link rel="stylesheet" href="./css/xadmin.css">
        <script type="text/javascript" src="./lib/layui/layui.js" charset="utf-8"></script>
        <script type="text/javascript" src="./js/xadmin.js"></script>
		<script type="text/javascript" src="./js/common.js"></script>
        <!-- 让IE8/9支持媒体查询，从而兼容栅格 -->
        <!--[if lt IE 9]>
            <script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
            <script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
        <![endif]--></head>
 <style>
.layui-upload-img{width: 92px; height: 92px; margin: 0 10px 10px 0;}
.layui-upload{margin-left: 70px;}
</style>
<script>
function getQueryVariable(variable)
	{
		   var query = window.location.search.substring(1);
		   var vars = query.split("&");
		   for (var i=0;i<vars.length;i++) {
				   var pair = vars[i].split("=");
				   if(pair[0] == variable){return pair[1];}
		   }
		   return(false);
	};
</script>
    <body>
        <div class="layui-fluid">
            <div class="layui-row">
                <form class="layui-form" action=""  lay-filter="example">
					<input type="hidden" id="main_image" name="main_image" value=""/>
					<input type="hidden" id="detail_image" name="detail_image" value=""/>
                    <div class="layui-form-item">
                        <label for="L_email" class="layui-form-label">
                            <span class="x-red">*</span>标题</label>
                        <div class="layui-input-inline">
                            <input type="text" id="L_email" name="title" required="" lay-verify="title" autocomplete="off" class="layui-input"></div>
                     </div>
					 
					 <div class="layui-form-item">
					     <div class="layui-upload">
					     	  <button type="button" class="layui-btn" id="test1">上传主图</button>
							  <blockquote class="layui-elem-quote layui-quote-nm" style="margin-top: 10px;">
								预览图：
								<div class="layui-upload-list" id="demo1"></div>
							 </blockquote>
					     </div> 
					  </div>
					 
					 
                    <div class="layui-form-item">
                        <label for="L_username" class="layui-form-label">
                            <span class="x-red">*</span>价格</label>
                        <div class="layui-input-inline">
                            <input type="text" id="L_username" name="price" required="" lay-verify="price" autocomplete="off" class="layui-input"></div>
                    </div>
                    <div class="layui-form-item">
                        <label for="L_pass" class="layui-form-label">
                            <span class="x-red">*</span>库存</label>
                        <div class="layui-input-inline">
                            <input type="text" id="L_pass" name="store" required="" lay-verify="store" autocomplete="off" class="layui-input"></div>
                    </div>
					<div class="layui-form-item">
						<label for="L_username" class="layui-form-label">
							<span class="x-red">*</span>类别</label>
						<div class="layui-input-inline">	
							  <select name="category" id="category" lay-verify="required">
							    <option value=""></option>  
							  </select>
					</div>
					<div class="layui-form-item">
					    <label for="L_username" class="layui-form-label">
					        <span class="x-red">*</span>颜色</label>
					    <div class="layui-input-inline">
					        <input type="text" id="L_username" name="color" required="" lay-verify="color" autocomplete="off" class="layui-input"></div>
					</div>
                    <div class="layui-form-item">
                        <label for="L_repass" class="layui-form-label">
                            <span class="x-red">*</span>尺码</label>
                        <div class="layui-input-inline">
                            <input type="text" id="L_repass" name="size" required="" lay-verify="size" autocomplete="off" class="layui-input"></div>
                    </div>
                    <div class="layui-form-item">
                        <label for="L_repass" class="layui-form-label"></label>
                        <button class="layui-btn" lay-filter="add" lay-submit="" id="test9">添加</button></div>
                </form>
            </div>
        </div>
		<script>
		layui.use('upload', function(){
		  var $ = layui.jquery
		  ,upload = layui.upload;
		  //普通图片上传
		  var uploadInst = upload.render({
			elem: '#test1'
			,url: 'http://127.0.0.1:5000/common/upload/?dir=product'
			,multiple: true
			,auto: false
			//,multiple: true
			,bindAction: '#test9'
			,before: function(obj){
			  //预读本地文件示例，不支持ie8
			  obj.preview(function(index, file, result){
				   //预读本地文件示例，不支持ie8
				  // $('#demo1').append('<img src="'+ result +'" alt="'+ file.name +'" class="layui-upload-img">')  //多文件上传
				// $('#demo1').attr('src', result); //图片链接（base64）//单文件上传
			  });
			}
			,choose: function (obj) {
                    //预读本地文件示例，不支持ie8
                    obj.preview(function (index, file, result) {
                        $('#demo1').append('<img src="'+ result +'" alt="'+ file.name +'" class="layui-upload-img">')
                    });
                }
			,done: function(res){
			  //如果上传失败
			  if(res.code > 0){
				return layer.msg('上传失败');
			  }
			  debugger
			  //上传成功
			  document.getElementById("main_image").value = document.getElementById("main_image").value+","+res.data;
			  
			}
			,error: function(){
				debugger
			  //演示失败状态，并实现重传
			  var demoText = $('#demoText');
			  demoText.html('<span style="color: #FF5722;">上传失败</span> <a class="layui-btn layui-btn-xs demo-reload">重试</a>');
			  demoText.find('.demo-reload').on('click', function(){
				// uploadInst.upload();
			  });
			}
			});
		  });
		  </script>
        <script>layui.use(['form', 'layer'],
            function() {
				 //表单初始赋值
				 	
                $ = layui.jquery;
				$.ajaxSettings.async = false;
                var form = layui.form,
                layer = layui.layer;
				// let product={}
				// $.get("http://127.0.0.1:5000/product/productDetail?id="+getQueryVariable("id"),function(data,status){
				// 	product=data
				// 	product= JSON.parse(product);
				// 	// uploadInst.upload();
				// });
				// form.val('example', product.data)
				
                //自定义验证规则
                form.verify({
                    title: function(value) {
                        if (value.length < 3) {
                            return '昵称至少得3个字符啊';
                        }
                    },
                });

                //监听提交
                form.on('submit(add)',
                function(data) {
					debugger
                    console.log(data);
					data=data.field
                    $.get(prop().serviceUrl+"/product/addproduct",data,function(data,status){
                    	product=data
                    	product= JSON.parse(product);
                    });
                    layer.alert("增加成功", {
                        icon: 6
                    },
                    function() {
                        // 获得frame索引
                        var index = parent.layer.getFrameIndex(window.name);
                        //关闭当前frame
                        parent.layer.close(index);
                    });
                    return false;
                });

            });
			
			//出适合类别下拉框
			layui.use(['form', 'layer'],function(){
			            var form = layui.form;
			            $.ajax({
			                url: prop().serviceUrl+"/product/getCategory",
			                dataType: 'json',
			                type: 'get',
			                success: function (data) {
								debugger
			                    console.log(data);//下面会提到这个data是什么值
			                    //使用循环遍历，给下拉列表赋值
			                    $.each(data.data, function (index, value) {
			                        // console.log(value.department_id);
			                        $('#category').append(new Option(value.name,value.cid));// 下拉菜单里添加元素
			                    });
			                    layui.form.render("select");//重新渲染 固定写法
			                }
			            })
			        });
			
			</script>
        <script>var _hmt = _hmt || []; (function() {
                var hm = document.createElement("script");
                hm.src = "https://hm.baidu.com/hm.js?b393d153aeb26b46e9431fabaf0f6190";
                var s = document.getElementsByTagName("script")[0];
                s.parentNode.insertBefore(hm, s);
            })();</script>
    </body>

</html>